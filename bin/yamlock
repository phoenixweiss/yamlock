#!/usr/bin/env node

async function loadCliEntry() {
  try {
    const distModule = await import('../dist/cli/cli.js');
    if (distModule.runCli) {
      return distModule.runCli;
    }
  } catch (error) {
    if (!(error.code === 'ERR_MODULE_NOT_FOUND' || (error.message && error.message.includes('dist/cli/cli.js')))) {
      throw error;
    }
  }

  try {
    const srcModule = await import('../src/cli/cli.js');
    if (srcModule.runCli) {
      return srcModule.runCli;
    }
  } catch (error) {
    if (!(error.code === 'ERR_MODULE_NOT_FOUND')) {
      throw error;
    }
  }

  throw new Error('CLI entry not found.');
}

loadCliEntry()
  .then((runCli) => runCli(process.argv))
  .catch((error) => {
    console.error('[yamlock] CLI failed to start:', error);
    process.exit(1);
  });
